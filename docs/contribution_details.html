<!DOCTYPE html>
<html>
<head>
	<title>Catalog Agrogeophysic</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Bootstrap CSS File -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">


	 	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>

	<!-- boostrap select -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>

	<!-- Favicons 
	<link href="img/favicon.png" rel="icon">
	<link href="img/apple-touch-icon.png" rel="apple-touch-icon">
	 -->
	 
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,600,700,700i|Montserrat:300,400,500,600,700" rel="stylesheet">

	<!-- Libraries CSS Files -->
	<link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="lib/animate/animate.min.css" rel="stylesheet">
	<link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">
	<link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
	<link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">



	<!-- parsing .csv database -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="js/papaparse.min.js"></script>

	<!-- Main Stylesheet File -->
	<!-- 	<link href="css/style.css" rel="stylesheet">  -->
 	<link href="css/style_contrib_details.css" rel="stylesheet">


</head>

<style type="text/css">

#imgfixed
{
    top:20px;
    background: blue;
    position: fixed;
    width: 25%;
}

</style>


<body>
	<header id="header_home">
		      <nav class="main-nav float-right d-none d-lg-block">
		        <ul>
		          <li class="active"><a href="index.html">Home</a></li>
		      </nav>
		    <div class="container">
		      <div class="logo float-left">
		        <!-- Uncomment below if you prefer to use an image logo -->
		        <h1 class="text-light"><a href="index.html" class="scrollto"><span>Catalog of agrogeophysical studies</span></a></h1>

						<!-- <a href="#header" class="scrollto"><img src="img/logo.png" alt="" class="img-fluid"></a> -->
		      </div>
		    </div>
	</header>


  <section id="about">
    <div class="container">
      <div class="row">

        <div class="col-lg-5 col-md-6" >
           <div class="sticky-top">
          	<div class="about-img">
							<p>
								<img id="cover_picture" src="img/map/Eco_leaves_nature-512.png" width="40">
							<p>
			</div>
			<img src="img/CCBY.png" width="3">
            <h1 id="title"></h1>
            <div class="p-3 mb-2 bg-warning text-dark">
		      	    	We evaluated that this contribution does not yet completely fullfill FAIR practices and CAGS guidelines. 
		     			In order to improve it, we invite the authors to: 
		      	    	 <ul>
		      	    	 	<li>enrich metadata;</li>
		      	    	 	<!-- {% if row['dataset_link'] } -->
		      	    	 	<li id="no_dataset_warming"><b></b></li>
		      	    	 	<li id="no_notebook_warming"><b></b></li>
		      	    	 </ul>
		      			See more in the <a id="link_doc" href="https://agrogeophy.github.io/catalog/docs/getting-started.html"  target="_blank"><b>CAGS documentation</b></a>
		      </div>
          </div>
       </div>
           <div class="col-lg-7 col-md-6">
<!--           					<div id="title"> <h1> <b>Title:</b></h1> -->
              <div class="about-content">

								<h2 id="metrics">Metrics</h2>
	                <div id="altmetric" class="altmetric-embed" data-badge-type="donut" data-doi="">
									</div>

               <p>
                <h2>Contribution overview</h2>
                  <ul class="list-group">
										<li id="contribution_type" class="list-group-item"><b>Type: </b></li>
										<li id="keywords" class="list-group-item"><b>Keywords: </b></li>
                    <li class="list-group-item"><a id="link" href="https://dx.doi.org/"  target="_blank"><b>Link to publication</b></a></li>
              		</ul>
               </p>

               <p>
               <h2>Prospection</h2>
               	<ul class="list-group">
									<li class="list-group-item" id="publication_date"><b>Date: </b></li>
									<li class="list-group-item" id="latlong"><b>Lat/long: </b></li>
									<li class="list-group-item" id="method"><b>Method(s): </b></li>
									<li class="list-group-item" id="spatial_scale"><b>Spatial Scale: </b></li>
									<li class="list-group-item" id="temporal_scale"><b>Temporal Scale: </b></li>
                  <li class="list-group-item" id="instrument"><b>Instrument: </b></li>
	                <li class="list-group-item" id="dimension"><b>Dimension: </b></li>
									<li class="list-group-item" id="permanent_setup"><b>Permanent setup: </b></li>
                </ul>
               </p>

               <p>
             <h2>Processing tools</h2>
               <ul class="list-group">
	               <li class="list-group-item" id="software_name"><b>Software: </b></li>
	               <li class="list-group-item" id="software_licence"><b>Licence type: </b></li>
               </ul>
               </p>

               <p>
               <h2>Biotic</h2>
                 <ul class="list-group">                 	
		               <li class="list-group-item" id="plant"><b>Species: </b></li>
		               <li class="list-group-item" id="organ"><b>Organ: </b></li>
                 </ul>
               </p>

               <p>
               <h2>Abiotic description</h2>
                 <ul class="list-group">
	               	<li class="list-group-item" id="soil"><b>Soil type: </b></li>
	                <li class="list-group-item" id="water"><b>Water input: </b></li>
               	 </ul>
               </p>

               <p>
               <h2>Contact description</h2>
               	 <ul class="list-group">
									 <li class="list-group-item" id="authors"><b>Contrib. Authors: </b></li>
                   <li class="list-group-item" id="surname_name"><b>1st. Author: </b></li>
									 <li class="list-group-item" id="email"><b>Email: </b></li>
                   <li class="list-group-item"><a id="author_contact" href=mailto:><b>Contact the author</b></a></li>
                </ul>
               </p>


						<!-- notebook specific -->
					 <p>
           <h2>Notebook details</h2>
						<h4><a id="mybinder" href="https://mybinder.org/v2/gh/agrogeophy/notebooks/master?filepath=notebooks/" class="btn btn-primary" target="_blank">Try model in binder </a></h4>

						<h4><a id="nbviewer" href="https://nbviewer.org/github/agrogeophy/notebooks/blob/master/notebooks/?filepath=notebooks/" class="btn btn-primary" target="_blank">View notebook in nbviewer</a></h4>
            </p>

						<!-- dataset specific -->
						<p>
           <h2>Dataset details</h2>
							<h4><a id="dataset_link" href="" class="btn btn-primary" target="_blank"> Link to data repository</a></h4>

						  <h4>
						  	<a id="dataset_app" href="https://share.streamlit.io/benjmy/ert_swc_board/main/app.py" class="btn btn-primary" target="_blank">Visualise dataset in streamlit </a>
						  </h4


               	 <ul class="list-group">
									 <li class="list-group-item" id="dataset_licence"><b>Licence: </b></li>
                   <li class="list-group-item" id="dataset_type"><b>Familly: </b></li>
									 <li class="list-group-item" id="dataset_comment"><b>Comment: </b></li>
                </ul>
            </p>

						<p>
						<h4><a id="metadata_download" class="btn btn-success" > Download metadata </a></h4>
          	</p>

						<p>
          		<h4>
          			<a href="mailto:hello.agrogeophy@gmail.com?subject=error%20dbb%20Agrogeophysic" class="btn btn-danger">Report an error </a>
          		</h4>
          	</p>

          </div>
        </div>
      </div>
    </div>

  </section>




<script type="text/javascript">

		// load csv database (it should already be cached from catalog.html)
	Papa.parse("https://raw.githubusercontent.com/agrogeophy/catalog/master/db.csv", {
	  download: true,
	  header: true,
	  //worker: true, // for large csv
	  complete: function(res) {
	    console.log('database loaded:', res);
	    callback(res)
	    }
	  });

	function callback(res) {
		const db = res.data

		// get url parameters
		const queryString = window.location.search
		const urlParams = new URLSearchParams(queryString)
		const id = urlParams.get('id')
		let row = null
		for (let i = 0; i < db.length; i++) {
			if (db[i]['id'] == id) {
				row = db[i]
			}
		}
		if (row == null) {
			console.log('ERROR: id ' + id + ' has not been found in the database.')
		}
		console.log(row)

		function addInfo(id, val) {
			let a = document.getElementById(id)
			if (val != '' && typeof(val) != 'undefined') {
				a.innerHTML = a.innerHTML + val
			} else {
				a.remove()
			}
		}

		function addAttr(id, val, attr) {
			let a = document.getElementById(id)
			if (val != '' && typeof(val) != 'undefined') {
				a.setAttribute(attr, val)
			} else {
				a.remove()
			}
		}

		let cover_picture = "img/map/Eco_leaves_nature-512.png"
		if (row['cover_picture'] != '') {
			cover_picture = "img/cover_pictures/" + row['cover_picture']
		}
		document.getElementById('cover_picture').setAttribute('src',cover_picture)
		// addInfo('title', row['title'])

		// contribution overview
		addInfo('title', row['title'])
		addInfo('contribution_type', row['contribution_type'])
		addInfo('keywords', row['keywords'])
		addAttr('link', row['publication_link'], 'href')

		// contact description
		addInfo('authors', row['authors'])
		if (row['surname'] != '') {
			addInfo('surname_name', row['surname'] + ' ' + row['name'])
		} else {
			document.getElementById('surname_name').remove()
		}
		addInfo('email', row['email'])
		if (row['email'] != '') {
			addAttr('author_contact', 'mailto:' + row['email'] + '?subject=CAGS%20contribution')
		} else {
			document.getElementById('author_contact').parentNode.remove()
		}



		if (row['contribution_type'] == 'Peer reviewed publication') {
			if (row['publication_link'].indexOf('doi') != -1) {
				let doi = row['publication_link'].split('.org/')[1]
				document.getElementById('altmetric').setAttribute('data-doi', doi)
			}

			// prospection
			addInfo('publication_date', row['publication_date'])
			if (row['latitude'] != '') {
				addInfo('latlong', row['latitude'] + '; ' + row['longitude'])
			} else {
				document.getElementById('latlong').style.visibility = 'hidden'
			}
			addInfo('method', row['method'])
			addInfo('spatial_scale', row['spatial_scale'])
			addInfo('temporal_scale', row['temporal_scale'])
			addInfo('instrument', row['instrument'])
			addInfo('dimension', row['dimension'])
			addInfo('permanent_setup', row['permanent_setup'])

			// processing tools
			addInfo('software_name', row['software_name'])
			addInfo('software_licence', row['software_licence'])

			// biotic
			addInfo('plant', row['plant'])
			addInfo('organ', row['organ'])

			// abiotic
			addInfo('soil', row['soil'])
			addInfo('water', row['water'])

			if (row['dataset_link'] != '') {
				addAttr('dataset_link', row['dataset_link'], 'href')
			  addInfo('dataset_licence', row['dataset_licence'])
			  addInfo('dataset_type', row['dataset_type'])
			  addInfo('dataset_comment', row['dataset_comment'])
				document.getElementById('no_dataset_warming').remove()

			}

			if (row['notebook_filename'] != '') {
				let a = document.getElementById('mybinder')
				a.setAttribute('href', 'https://mybinder.org/v2/gh/agrogeophy/notebooks/master?filepath=notebooks/' + row['notebook_filename'])
				document.getElementById('no_notebook_warming').remove()
			}


		} 
		
		else if (row['contribution_type'] == 'Notebook') {
			let a = document.getElementById('mybinder')
			a.setAttribute('href', 'https://mybinder.org/v2/gh/agrogeophy/notebooks/master?filepath=notebooks/' + row['notebook_filename'])
			// document.getElementById('dataset').remove()

		} 
		
		
		else if (row['contribution_type'] == 'Dataset') {
			let a = document.getElementById('dataset_link')

			addAttr('dataset_link', row['dataset_link'], 'href')
			addInfo('dataset_licence', row['dataset_licence'])
			addInfo('dataset_type', row['dataset_type'])
			addInfo('dataset_comment', row['dataset_comment'])

			if 	(row['dataset_type']== 'ER_SWC'){
					addAttr('dataset_app', 'https://share.streamlit.io/benjmy/ert_swc_board/main/app.py', 'href')
					}


			document.getElementById('mybinder').remove()
		}
		
		

		if (row['dataset_link']	== '') {	
			addInfo('no_dataset_warming', 'link the article with a dataset;')
			document.getElementById('dataset').remove()
		}
		
			
		if (row['notebook_filename'] == '') {	
			addInfo('no_notebook_warming', 'link the article with a compagnion computationnal notebook;')
			document.getElementById('mybinder').remove()
		}	
		
		


		metadata_download.onclick = function(){
																	var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(row));
																	var dlAnchorElem = document.getElementById('metadata_download');
																	dlAnchorElem.setAttribute("href",     dataStr     );
																	dlAnchorElem.setAttribute("download", "metadata.json");
																};



		// remove all empty list group and their above h6 title
		let uls = document.getElementsByClassName('list-group')
		for (let i = 0; i < uls.length; i++) {
			let children = uls[i].children
			let visible = false
			for (let j = 0; j < children.length; j++) {
				var visibility = uls[i].children[j].style.visibility
				if (visibility == '' || visibility == 'visible') {
					visible = true
				}
			}
			if (visible == false) {
				uls[i].previousSibling.previousSibling.remove() // remove h6 title
				uls[i].remove()

			}
		}

	} 


</script>

<!-- # https://api.altmetric.com/embeds.html -->
<script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>

<footer>
</footer>

</body>
</html>
